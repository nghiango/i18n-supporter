<mat-sidenav-container class="example-container">
  <mat-sidenav mode="side" opened style="width: 20%" #sidenav>
    <div class="json-tree__menu">
      <button mat-flat-button color="primary" [matMenuTriggerFor]="menu">Menu</button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="fileImport.click()">Import</button>
        <button mat-menu-item (click)="exportToFiles()">Export</button>
      </mat-menu>

      <input type="file" [hidden]="true" #fileImport
             id="file"
             (change)="handleFileInput($event)"
             placeholder="Choose File"
             multiple>
    </div>
    <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="example-tree">
      <!-- This is the tree node template for leaf nodes -->
      <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
        <li class="mat-tree-node">
          <!-- use a disabled button to provide padding for tree leaf -->

          <div *ngIf="node.editingNumber === editNumber" class="d-flex align-items-center">
            <ng-container *ngTemplateOutlet="inputTemplate, context: {$implicit: node}"></ng-container>
          </div>
          <div *ngIf="node.editingNumber !== editNumber" class="d-flex">
            <a (click)="openNode(node)" class="item--clickable" [ngClass]="{'json-tree--node-active': node.selected}">
              {{node.name}}
            </a>
            <ng-container *ngTemplateOutlet="nodeMenuTemplate, context: {$implicit: node}"></ng-container>
          </div>
        </li>
      </mat-tree-node>
      <!-- This is the tree node template for expandable nodes -->
      <mat-nested-tree-node *matTreeNodeDef="let node; when:  hasChild">
        <li>
          <div class="mat-tree-node">
            <button mat-icon-button matTreeNodeToggle
                    [attr.aria-label]="'toggle ' + node.name">
              <mat-icon class="mat-icon-rtl-mirror">
                {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
              </mat-icon>
            </button>
            <div *ngIf="node.editingNumber  === editNumber" class="d-flex align-items-center">
              <ng-container *ngTemplateOutlet="inputTemplate, context: {$implicit: node}"></ng-container>
            </div>
            <div *ngIf="node.editingNumber  !== editNumber" class="d-flex">
              <div matTreeNodeToggle
                   [attr.aria-label]="'toggle ' + node.name"
                   class="item--clickable">
                {{node.name}}
              </div>
              <ng-container *ngTemplateOutlet="nodeMenuTemplate, context: {$implicit: node}"></ng-container>
            </div>

          </div>
          <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
            <ng-container matTreeNodeOutlet></ng-container>
          </ul>
        </li>
      </mat-nested-tree-node>
    </mat-tree>
  </mat-sidenav>
  <mat-sidenav-content>
    <button *ngIf="!sidenav.opened" mat-flat-button (click)="sidenav.toggle()">Open Sidenav</button>
    <div class="json-tree__content" *ngIf="currentNode">
      <div class="json-tree__header">
        <h3>{{currentNode.name}}</h3>
        <mat-icon class="icon__medium icon--red item--clickable"
                  (click)="removeKey(currentNode)">delete_forever</mat-icon>
      </div>
      <div *ngFor="let file of files">
        <div class="json-tree__row">
          <mat-icon *ngIf="file.notExisted"
                    class="icon__medium icon--green item--clickable json-tree__right-icon"
                    (click)="addKeyInFile(file)">add</mat-icon>
          <mat-icon *ngIf="!file.notExisted"
                    class="icon__medium icon--red item--clickable json-tree__right-icon"
                    (click)="removeKeyInFile(file)">delete_forever</mat-icon>
          <mat-form-field style="width: 100%">
            <mat-label>{{file.fileName}}</mat-label>
            <input matInput placeholder="Please fill value" [formControl]="file.formControl" (change)="updateValueForDictionary(file)">
          </mat-form-field>
        </div>
      </div>
    </div>

  </mat-sidenav-content>
</mat-sidenav-container>

<ng-template #nodeMenuTemplate let-node>
  <mat-icon class="item--clickable" [matMenuTriggerFor]="menuNode">more_vert</mat-icon>
  <mat-menu #menuNode="matMenu">
    <button mat-menu-item (click)="addKey(node)">Add Key</button>
    <button mat-menu-item (click)="enterEditMode(node)">Rename Key</button>
    <button mat-menu-item (click)="removeKey(node)">Remove Key</button>
  </mat-menu>
</ng-template>

<ng-template #inputTemplate let-node>
  <mat-form-field style="width: 100%">
    <input matInput placeholder="Please fill value" [formControl]="node.formControl" required>
  </mat-form-field>
  <mat-icon class="item--clickable icon--green" (click)="updateKeyName(node)">done</mat-icon>
  <mat-icon class="item--clickable icon--red" (click)="exitEditMode(node)">close</mat-icon>
</ng-template>


